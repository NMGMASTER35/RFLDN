<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="New_Routflow_London_Logo.png" type="image/png">
  <title>Routeflow London</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #d32f2f;
      --primary-dark: #b71c1c;
      --background-dark: #121212;
      --foreground-dark: #fafafa;
      --header-bg-dark: #181818;
      --menu-blur: blur(16px);
    }
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--background-dark);
      color: var(--foreground-dark);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.1rem 1.8rem;
      background: var(--header-bg-dark);
      color: #fff;
      position: sticky;
      top: 0;
      z-index: 40;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }
    .logo img { height: 38px; }
    .menu-bar {
      display: flex;
      align-items: center;
      gap: 1.1rem;
    }
    .main-nav {
      display: none;
      gap: 0.2rem;
      align-items: center;
    }
    .main-nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.97rem;
      padding: 0.22rem 0.68rem;
      border-radius: 5px;
      transition: background 0.18s, color 0.18s;
      margin: 0 0.03rem;
      letter-spacing: 0.01em;
    }
    .main-nav a:hover, .main-nav a:focus {
      background: var(--primary);
      color: #fff;
    }
    .hamburger {
      display: block;
      background: none;
      border: none;
      font-size: 1.55rem;
      color: var(--primary);
      padding: 0.24rem 0.7rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .hamburger:hover, .hamburger:focus {
      background: rgba(255,0,0,0.08);
    }
    @media (min-width: 900px) {
      .main-nav { display: flex; }
      .hamburger { display: none; }
      .popout-menu { display: none !important; }
    }
    .account-icon {
      position: relative;
      display: flex;
      align-items: center;
    }
    .account-icon button {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      font-size: 1.22rem;
      color: #fff;
      padding: 0.19rem 0.55rem;
      border-radius: 6px;
      transition: background 0.2s;
    }
    .account-icon button:hover, .account-icon button:focus {
      background: rgba(255,0,0,0.13);
    }
    .account-dropdown {
      display: none;
      flex-direction: column;
      gap: 0.4rem;
      position: absolute;
      right: 0;
      top: 110%;
      min-width: 140px;
      background: #232323;
      color: #fafafa;
      border: 1px solid #444;
      border-radius: 7px;
      padding: 0.6rem 0.5rem;
      box-shadow: 0 6px 24px rgba(0,0,0,0.13);
      z-index: 99;
      animation: dropdownFadeIn 0.2s;
    }
    .account-icon:hover .account-dropdown,
    .account-icon:focus-within .account-dropdown {
      display: flex;
    }
    .account-dropdown a, .account-dropdown button {
      text-decoration: none;
      color: inherit;
      font-weight: 600;
      padding: 0.35rem 0.5rem;
      border-radius: 5px;
      transition: background 0.15s, color 0.15s;
      background: none;
      border: none;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 1rem;
    }
    .account-dropdown a:hover, .account-dropdown a:focus,
    .account-dropdown button:hover, .account-dropdown button:focus {
      background: var(--primary);
      color: #fff;
    }
    @keyframes dropdownFadeIn {
      from { opacity:0; transform: translateY(-8px);}
      to { opacity:1; transform: translateY(0);}
    }
    .popout-menu {
      position: fixed;
      top: 0;
      right: 0;
      width: 220px;
      height: 100vh;
      background: rgba(31, 10, 10, 0.94);
      backdrop-filter: blur(12px);
      box-shadow: -6px 0 30px rgba(0,0,0,0.24);
      z-index: 999;
      display: flex;
      flex-direction: column;
      padding: 1.4rem 0.6rem 1.4rem 0.6rem;
      gap: 0.65rem;
      transform: translateX(100%);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.3s cubic-bezier(.23,.93,.41,.98), opacity 0.19s;
    }
    .popout-menu.active {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }
    .popout-menu .back-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(0,0,0,0.23);
      border: none;
      color: #fff;
      font-size: .99rem;
      padding: 0.4rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 0.6rem;
      font-weight: 600;
      transition: background 0.14s;
    }
    .popout-menu .back-btn:hover {
      background: rgba(0,0,0,0.30);
    }
    .popout-menu a {
      color: #fff;
      font-weight: 700;
      text-decoration: none;
      font-size: 1rem;
      padding: 0.35rem 0.5rem;
      border-radius: 6px;
      transition: background 0.18s, color 0.18s;
      background: none;
      display: block;
      margin: 0.06rem 0;
    }
    .popout-menu a:hover, .popout-menu a:focus {
      background: #fff2;
      color: #fffbe6;
      text-decoration: underline;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background: rgba(24,27,32,0.88);
    }
    .modal-content {
      background-color: #232323;
      margin: 8% auto;
      padding: 28px 20px 20px 20px;
      border-radius: 9px;
      width: 345px;
      position: relative;
      box-shadow: 0 4px 32px rgba(0,0,0,0.25);
      animation: appear 0.22s;
      color: #f8f9fa;
    }
    @keyframes appear {
      from { transform: translateY(-40px); opacity: 0;}
      to { transform: translateY(0); opacity: 1;}
    }
    .close {
      position: absolute;
      top: 10px; right: 15px;
      font-size: 25px;
      color: #adb5bd;
      cursor: pointer;
      transition: color 0.18s;
      font-weight: bold;
      user-select: none;
    }
    .close:hover {
      color: #f03e3e;
    }
    .modal-content h2 {
      margin-top: 0;
      color: #fff;
      font-size: 1.45rem;
      margin-bottom: 18px;
      letter-spacing: 0.8px;
    }
    .modal form input {
      width: 97%;
      margin-bottom: 13px;
      padding: 10px 8px;
      border-radius: 4px;
      border: 1px solid #495057;
      font-size: 1rem;
      background: #181b20;
      color: #f8f9fa;
      transition: border 0.18s;
    }
    .modal form input:focus {
      outline: none;
      border: 1.5px solid #d32f2f;
    }
    .modal form button {
      width: 100%;
      padding: 11px 0;
      background: #d32f2f;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 1.08rem;
      margin-bottom: 10px;
      font-weight: bold;
      letter-spacing: 0.2px;
      cursor: pointer;
      transition: background 0.18s;
    }
    .modal form button:hover {
      background: #b71c1c;
    }
    .modal form p {
      margin-top: 0;
      font-size: 0.98rem;
      text-align: center;
      color: #adb5bd;
    }
    .modal form a {
      color: #d32f2f;
      text-decoration: none;
      cursor: pointer;
      transition: color 0.18s;
    }
    .modal form a:hover {
      color: #b71c1c;
      text-decoration: underline;
    }
    .modal .error-message {
      background: #c92a2a;
      color: #fff;
      padding: 8px 0;
      text-align: center;
      border-radius: 4px;
      margin-bottom: 12px;
      font-size: 0.99rem;
    }
    /* ... rest of your app's CSS... (hero, carousel, etc.) ... */
    /* Keep your other original styles here */
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="Routeflow London permanent logo.png" alt="RouteFlow London Logo">
      <strong>RouteFlow London</strong>
    </div>
    <div class="menu-bar">
      <nav class="main-nav">
        <a href="#">Home</a>
        <a href="#">Dashboard</a>
        <a href="#">Tracking</a>
        <a href="#">Planning</a>
        <a href="#">Routes</a>
        <a href="#">Withdrawn</a>
        <a href="#">Disruptions</a>
        <a href="#">Fleet</a>
      </nav>
      <button class="hamburger" id="hamburgerBtn" aria-label="Open menu">
        <i class="fa-solid fa-bars"></i>
      </button>
      <div class="account-icon" id="profileMenu">
        <button aria-label="Account" id="profileIcon">
          <i class="fa-regular fa-user"></i>
        </button>
        <div class="account-dropdown" id="dropdownContent"></div>
      </div>
    </div>
    <nav class="popout-menu" id="popoutMenu">
      <button class="back-btn" id="menuBackBtn"><i class="fa-solid fa-arrow-left"></i> Back</button>
      <a href="#">Home</a>
      <a href="#">Dashboard</a>
      <a href="#">Tracking</a>
      <a href="#">Planning</a>
      <a href="#">Routes</a>
      <a href="#">Withdrawn</a>
      <a href="#">Disruptions</a>
      <a href="#">Fleet</a>
    </nav>
  </header>

  <!-- Login/Signup Modal -->
  <div id="authModal" class="modal" aria-modal="true" role="dialog">
    <div class="modal-content">
      <span class="close" id="closeModal" title="Close">&times;</span>
      <!-- Login Form -->
      <div id="loginFormContainer">
        <h2>Login</h2>
        <form id="loginForm" autocomplete="off">
          <input type="email" id="loginEmail" placeholder="Email" required autocomplete="username">
          <input type="password" id="loginPassword" placeholder="Password" required autocomplete="current-password">
          <button type="submit">Login</button>
          <div class="error-message" id="loginError" style="display:none;"></div>
        </form>
        <p>Don't have an account? <a href="#" id="showSignup">Sign up</a></p>
      </div>
      <!-- Signup Form -->
      <div id="signupFormContainer" style="display:none;">
        <h2>Sign Up</h2>
        <form id="signupForm" autocomplete="off">
          <input type="email" id="signupEmail" placeholder="Email" required autocomplete="username">
          <input type="password" id="signupPassword" placeholder="Password" required autocomplete="new-password">
          <button type="submit">Sign Up</button>
          <div class="error-message" id="signupError" style="display:none;"></div>
        </form>
        <p>Already have an account? <a href="#" id="showLogin">Login</a></p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <section class="landing-hero">
    <div class="hero-card">
      <img src="Routeflow London permanent logo.png" alt="RouteFlow London Logo" class="hero-logo" />
      <h1>Welcome to RouteFlow London!</h1>
      <p class="hero-subtitle">London Travel. Reimagined.</p>
      <form class="hero-search" onsubmit="return false;">
        <input type="text" placeholder="Search by route, stop, or bus..." />
        <button type="submit"><i class="fa fa-search"></i></button>
      </form>
      <div class="hero-buttons">
        <a class="explore" href="#">Explore Map</a>
        <a class="learn" href="#">Learn More</a>
      </div>
    </div>
  </section>
  <section class="carousel">
    <div class="carousel-container">
      <div class="carousel-title">New London Buses</div>
      <button class="carousel-arrow left" id="carouselPrev" aria-label="Previous bus"><i class="fa-solid fa-angle-left"></i></button>
      <div class="carousel-images" id="carouselImages">
        <img src="https://static.wikia.nocookie.net/bus-routes-in-london/images/3/34/TUK-3087_on_381.png" alt="Bus 1" data-caption="Electroliner | Route 381" class="active"/>
        <img src="https://static.wikia.nocookie.net/bus-routes-in-london/images/e/e2/WSE2933.jpg" alt="Bus 2" data-caption="Electroliner Kite | Route 153"/>
        <img src="https://static.wikia.nocookie.net/bus-routes-in-london/images/2/25/80403_on_SL3.webp" alt="Bus 3" data-caption="Enviro 400ev | Route SL3"/>
        <img src="https://static.wikia.nocookie.net/bus-routes-in-london/images/e/e0/EBD19_on_Route_320.jpg" alt="Bus 4" data-caption="BD11 | Route 320"/>
      </div>
      <button class="carousel-arrow right" id="carouselNext" aria-label="Next bus"><i class="fa-solid fa-angle-right"></i></button>
      <div class="carousel-caption" id="carouselCaption">Electroliner | Route 381</div>
    </div>
  </section>
  <section class="newsletter">
    <div class="newsletter-box">
      <h2>Get updates on new features and sightings</h2>
      <p>Sign up for our newsletter to get the latest on live tracking, rare sightings, and London bus news.</p>
      <form id="newsletter-form">
        <input type="email" id="email" placeholder="Enter your email" required />
        <button type="submit">Subscribe</button>
      </form>
      <div class="response" id="response-message"></div>
    </div>
  </section>
  <section class="about">
    <h2>About RouteFlow London</h2>
    <p>
      RouteFlow London is a next-generation platform for exploring London's iconic bus network.
      Track vehicles live, explore rare workings, dive into historical data, and connect with the enthusiast community.
      Built from scratch for London's unique transit scene.
    </p>
  </section>
  <section id="blog">
    <h2>Latest Blog Posts</h2>
    <div class="blog-preview">
      <article class="blog-card">
        <span class="blog-date">May 2025</span>
        <h3>Hidden Buses of Zone 6</h3>
        <p>A journey to London's farthest reaches, hunting for rare bus gems and snap-worthy moments.</p>
      </article>
      <article class="blog-card">
        <span class="blog-date">April 2025</span>
        <h3>Fleet Tech Upgrades</h3>
        <p>How TfL's newest buses are greener, smarter, and more connected than ever.</p>
      </article>
      <article class="blog-card">
        <span class="blog-date">March 2025</span>
        <h3>Meet the Enthusiasts</h3>
        <p>Spotlight on the passionate community tracking London's bus history in real time.</p>
      </article>
    </div>
  </section>
  <footer>
    <div class="footer-links">
      <a href="#">About</a> |
      <a href="#">Privacy</a> |
      <a href="#">Terms</a> |
      <a href="#">Contact</a>
    </div>
    <div class="social-icons">
      <a href="#"><i class="fa-brands fa-discord"></i></a>
      <a href="#"><i class="fab fa-tiktok"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
    </div>
    <small>Made for London. Built from scratch.</small>
  </footer>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDuedLuagA4IXc9ZMG9wvoak-sRrhtFZfo",
      authDomain: "routeflow-london.firebaseapp.com",
      projectId: "routeflow-london",
      storageBucket: "routeflow-london.firebasestorage.app",
      messagingSenderId: "368346241440",
      appId: "1:368346241440:web:7cc87d551420459251ecc5"
    };
    firebase.initializeApp(firebaseConfig);

    // Hamburger menu open/close
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const popoutMenu = document.getElementById('popoutMenu');
    const menuBackBtn = document.getElementById('menuBackBtn');
    hamburgerBtn.onclick = function(e) {
      e.stopPropagation();
      popoutMenu.classList.add('active');
    }
    menuBackBtn.onclick = function() {
      popoutMenu.classList.remove('active');
    }
    document.addEventListener('click', function(e) {
      if (
        popoutMenu.classList.contains('active') &&
        !popoutMenu.contains(e.target) &&
        e.target !== hamburgerBtn
      ) {
        popoutMenu.classList.remove('active');
      }
    });
    // Carousel logic
    const carouselImages = document.querySelectorAll('#carouselImages img');
    const carouselCaption = document.getElementById('carouselCaption');
    let currentIndex = 0;
    function showCarousel(idx) {
      carouselImages.forEach((img, i) => {
        img.classList.toggle('active', i === idx);
      });
      carouselCaption.textContent = carouselImages[idx].dataset.caption || '';
    }
    document.getElementById('carouselPrev').onclick = function() {
      currentIndex = (currentIndex - 1 + carouselImages.length) % carouselImages.length;
      showCarousel(currentIndex);
    }
    document.getElementById('carouselNext').onclick = function() {
      currentIndex = (currentIndex + 1) % carouselImages.length;
      showCarousel(currentIndex);
    }
    // Swipe support for carousel
    let startX = null;
    document.getElementById('carouselImages').addEventListener('touchstart', e => {
      startX = e.touches[0].clientX;
    });
    document.getElementById('carouselImages').addEventListener('touchend', e => {
      if (startX === null) return;
      let diff = e.changedTouches[0].clientX - startX;
      if (diff > 50) document.getElementById('carouselPrev').click();
      else if (diff < -50) document.getElementById('carouselNext').click();
      startX = null;
    });
    // Newsletter form
    document.getElementById('newsletter-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const message = document.getElementById('response-message');
      // For demo, just show message
      message.textContent = 'You have been subscribed!';
      this.reset();
      setTimeout(() => message.textContent = '', 4000);
    });

    // --- Auth Dropdown ---
    function renderDropdown(user) {
      const dropdown = document.getElementById('dropdownContent');
      dropdown.innerHTML = '';
      if (!user) {
        dropdown.innerHTML = `
          <a href="#" id="loginBtn">Login</a>
          <a href="#" id="signupBtn">Sign Up</a>
        `;
      } else {
        dropdown.innerHTML = `
          <a href="#" id="profileBtn">Profile</a>
          <a href="#" id="settingsBtn">Settings</a>
          <button id="logoutBtn" style="color:#f03e3e;">Logout</button>
        `;
      }
    }
    function closeModal() {
      document.getElementById('authModal').style.display = 'none';
      clearFormMessages();
      document.getElementById('loginForm').reset();
      document.getElementById('signupForm').reset();
    }
    function clearFormMessages() {
      document.getElementById('loginError').style.display = 'none';
      document.getElementById('signupError').style.display = 'none';
    }
    // Initial auth state
    firebase.auth().onAuthStateChanged(function(user) {
      renderDropdown(user);
    });
    document.addEventListener('DOMContentLoaded', function () {
      // Dropdown menu
      renderDropdown(firebase.auth().currentUser);
      const modal = document.getElementById('authModal');
      const closeModalEl = document.getElementById('closeModal');
      document.body.addEventListener('click', function (e) {
        // Login
        if (e.target.id === 'loginBtn') {
          e.preventDefault();
          document.getElementById('loginFormContainer').style.display = '';
          document.getElementById('signupFormContainer').style.display = 'none';
          modal.style.display = 'block';
          clearFormMessages();
        }
        // Signup
        if (e.target.id === 'signupBtn') {
          e.preventDefault();
          document.getElementById('loginFormContainer').style.display = 'none';
          document.getElementById('signupFormContainer').style.display = '';
          modal.style.display = 'block';
          clearFormMessages();
        }
        // Logout
        if (e.target.id === 'logoutBtn') {
          e.preventDefault();
          firebase.auth().signOut().then(() => {
            renderDropdown(null);
          });
        }
        // Profile
        if (e.target.id === 'profileBtn') {
          e.preventDefault();
          const user = firebase.auth().currentUser;
          alert(user ? 'Email: ' + user.email : "Not signed in");
        }
        // Settings
        if (e.target.id === 'settingsBtn') {
          e.preventDefault();
          alert('Settings are not available yet.');
        }
        // Switch to Signup
        if (e.target.id === 'showSignup') {
          e.preventDefault();
          document.getElementById('loginFormContainer').style.display = 'none';
          document.getElementById('signupFormContainer').style.display = '';
          clearFormMessages();
        }
        // Switch to Login
        if (e.target.id === 'showLogin') {
          e.preventDefault();
          document.getElementById('loginFormContainer').style.display = '';
          document.getElementById('signupFormContainer').style.display = 'none';
          clearFormMessages();
        }
        // Close Modal
        if (e.target === closeModalEl) {
          closeModal();
        }
      });

      // Login Form Submission
      document.getElementById('loginForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        clearFormMessages();
        firebase.auth().signInWithEmailAndPassword(email, password)
          .then(() => {
            renderDropdown(firebase.auth().currentUser);
            closeModal();
          })
          .catch((error) => {
            const loginError = document.getElementById('loginError');
            loginError.textContent = error.message;
            loginError.style.display = 'block';
          });
      });

      // Signup Form Submission
      document.getElementById('signupForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const email = document.getElementById('signupEmail').value.trim();
        const password = document.getElementById('signupPassword').value;
        clearFormMessages();
        firebase.auth().createUserWithEmailAndPassword(email, password)
          .then(() => {
            renderDropdown(firebase.auth().currentUser);
            closeModal();
          })
          .catch((error) => {
            const signupError = document.getElementById('signupError');
            signupError.textContent = error.message;
            signupError.style.display = 'block';
          });
      });

      // Close modal on outside click
      window.onclick = function(event) {
        if (event.target === modal) {
          closeModal();
        }
      }
      // ESC closes modal
      document.addEventListener('keydown', function(event) {
        if (event.key === "Escape") {
          closeModal();
        }
      });
    });
  </script>
</body>
</html>
